{% extends 'tenders/base.html' %}
{% load humanize %}

{% block title %}Home - KenGen Tender Tracking System{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="animate__animated animate__fadeInUp">
                    <i class="bi bi-lightning-charge-fill"></i>
                    Tender Tracking System
                </h1>
                <p class="lead mb-4">Streamline your procurement process with our comprehensive tender management solution. Track, manage, and analyze tenders efficiently.</p>
                <div class="d-flex gap-3">
                    <a href="{% url 'tenders:tender_list' %}" class="btn btn-light btn-lg">
                        <i class="bi bi-file-earmark-text"></i> View All Tenders
                    </a>
                    <a href="{% url 'tenders:dashboard' %}" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </div>
            </div>
            <div class="col-lg-4 text-center d-none d-lg-block">
                <i class="bi bi-clipboard-data" style="font-size: 10rem; opacity: 0.2;"></i>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
<section class="container my-5">
    <div class="row g-4">
        <div class="col-md-6 col-lg-3">
            <div class="stat-card primary">
                <div class="stat-icon">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <h3>{{ total_tenders|intcomma }}</h3>
                <p>Total Tenders</p>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="stat-card info">
                <div class="stat-icon">
                    <i class="bi bi-clipboard-check"></i>
                </div>
                <h3>{{ total_requisitions|intcomma }}</h3>
                <p>Total Requisitions</p>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="stat-card success">
                <div class="stat-icon">
                    <i class="bi bi-hourglass-split"></i>
                </div>
                <h3>{{ active_tenders|intcomma }}</h3>
                <p>Active Tenders</p>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="stat-card warning">
                <div class="stat-icon">
                    <i class="bi bi-file-check"></i>
                </div>
                <h3>{{ total_contracts|intcomma }}</h3>
                <p>Total Contracts</p>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="stat-card info">
                <div class="stat-icon">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <h3>{{ total_value|floatformat:0|intcomma }}M</h3>
                <p>Total Estimated Value (KSh)</p>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="container my-5">
    <div class="text-center mb-5">
        <h2 class="fw-bold">Key Features</h2>
        <p class="text-muted">Everything you need to manage tenders effectively</p>
    </div>
    <div class="row g-4">
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="bi bi-search" style="font-size: 3rem; color: var(--kengen-blue);"></i>
                    </div>
                    <h5 class="card-title">Advanced Search & Filters</h5>
                    <p class="card-text text-muted">Quickly find tenders using powerful search and filtering capabilities across multiple criteria.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="bi bi-graph-up" style="font-size: 3rem; color: var(--kengen-red);"></i>
                    </div>
                    <h5 class="card-title">Analytics & Reporting</h5>
                    <p class="card-text text-muted">Get insights with comprehensive analytics, charts, and reports on tender performance.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="bi bi-people-fill" style="font-size: 3rem; color: var(--warning-color);"></i>
                    </div>
                    <h5 class="card-title">Committee Management</h5>
                    <p class="card-text text-muted">Efficiently manage tender opening and evaluation committees with role assignments.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="bi bi-calendar-check" style="font-size: 3rem; color: var(--kengen-light-blue);"></i>
                    </div>
                    <h5 class="card-title">Timeline Tracking</h5>
                    <p class="card-text text-muted">Track important dates including advert, closing, validity, and evaluation deadlines.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="bi bi-shield-check" style="font-size: 3rem; color: var(--success-color);"></i>
                    </div>
                    <h5 class="card-title">Status Management</h5>
                    <p class="card-text text-muted">Monitor e-Contract Step, e-Contract Status, and procurement stages throughout the lifecycle.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <div class="mb-3">
                        <i class="bi bi-building" style="font-size: 3rem; color: var(--kengen-dark-blue);"></i>
                    </div>
                    <h5 class="card-title">Organizational Structure</h5>
                    <p class="card-text text-muted">Organized by regions, departments, divisions, and sections for better categorization.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Recent Requisitions & Contracts -->
{% if recent_requisitions or recent_contracts %}
<section class="container my-5">
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-clipboard-check"></i> Recent Requisitions</span>
                    {% if user.is_authenticated %}
                    <a href="{% url 'tenders:requisition_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if recent_requisitions %}
                    <ul class="list-group list-group-flush">
                        {% for requisition in recent_requisitions %}
                        <li class="list-group-item px-0">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>{{ requisition.e_requisition_no }}</strong>
                                    {% if requisition.department %}
                                    <div class="text-muted small">
                                        <i class="bi bi-building"></i> {{ requisition.department.name }}
                                    </div>
                                    {% endif %}
                                </div>
                                <small class="text-muted">{{ requisition.created_at|timesince }} ago</small>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-muted text-center mb-0">No recent requisitions</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-file-check"></i> Recent Contracts</span>
                    {% if user.is_authenticated %}
                    <a href="{% url 'tenders:tender_list' %}" class="btn btn-sm btn-outline-primary">View Tenders</a>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if recent_contracts %}
                    <ul class="list-group list-group-flush">
                        {% for contract in recent_contracts %}
                        <li class="list-group-item px-0">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>
                                        {% if user.is_authenticated %}
                                            <a href="{% url 'tenders:tender_detail' contract.tender.pk %}" class="text-decoration-none">
                                                {{ contract.contract_number|default:contract.tender.tender_id }}
                                            </a>
                                        {% else %}
                                            {{ contract.contract_number|default:contract.tender.tender_id }}
                                        {% endif %}
                                    </strong>
                                    {% if contract.contract_status %}
                                    <div class="text-muted small">
                                        <i class="bi bi-flag"></i> {{ contract.contract_status.name }}
                                    </div>
                                    {% endif %}
                                </div>
                                <small class="text-muted">{{ contract.created_at|timesince }} ago</small>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-muted text-center mb-0">No recent contracts</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Recent Tenders Section -->
{% if recent_tenders %}
<section class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Recent Tenders</h2>
        {% if user.is_authenticated %}
        <a href="{% url 'tenders:tender_list' %}" class="btn btn-primary">
            View All <i class="bi bi-arrow-right"></i>
        </a>
        {% else %}
        <a href="{% url 'tenders:login' %}" class="btn btn-primary">
            Login to View All <i class="bi bi-arrow-right"></i>
        </a>
        {% endif %}
    </div>
    
    {% if not user.is_authenticated %}
    <div class="alert alert-info mb-4">
        <i class="bi bi-info-circle"></i>
        <strong>Login Required:</strong> Sign in to view full tender details, access the dashboard, and manage tenders.
        <a href="{% url 'tenders:signup' %}" class="alert-link">Create an account</a> if you don't have one.
    </div>
    {% endif %}
    
    <div class="row">
        {% for tender in recent_tenders %}
        <div class="col-12">
            <div class="tender-item">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h5 class="mb-2">
                                {% if user.is_authenticated %}
                                    <a href="{% url 'tenders:tender_detail' tender.pk %}" class="text-decoration-none text-dark">
                                        {{ tender.tender_id }}
                                    </a>
                            {% else %}
                                {{ tender.tender_id }}
                            {% endif %}
                        </h5>
                        <p class="text-muted mb-2">{{ tender.tender_description|truncatewords:20 }}</p>
                        <div class="d-flex flex-wrap gap-2">
                            {% if tender.requisition and tender.requisition.region %}
                            <span class="badge" style="background-color: var(--kengen-blue); color: white;">
                                <i class="bi bi-geo-alt"></i> {{ tender.requisition.region.name }}
                            </span>
                            {% endif %}
                            {% if tender.requisition and tender.requisition.department %}
                            <span class="badge" style="background-color: var(--kengen-dark-blue); color: white;">
                                <i class="bi bi-building"></i> {{ tender.requisition.department.name }}
                            </span>
                            {% endif %}
                                {% if tender.procurement_method %}
                            <span class="badge" style="background-color: var(--kengen-light-blue); color: white;">
                                    {{ tender.get_procurement_method_display }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                        {% if tender.loa_status %}
                        <div class="mb-2">
                            <small class="text-muted">e-Contract Step:</small>
                            <span class="badge" style="background-color: var(--kengen-red); color: white;">{{ tender.loa_status.name }}</span>
                        </div>
                        {% endif %}
                        {% if tender.tender_closing_date %}
                        <div>
                            <small class="text-muted">
                                <i class="bi bi-calendar"></i> Closes: {{ tender.tender_closing_date|date:"d M Y" }}
                            </small>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Call to Action -->
<!-- <section class="container my-5">
    <div class="card bg-primary text-white">
        <div class="card-body text-center py-5">
            <h2 class="fw-bold mb-3">Ready to Get Started?</h2>
            <p class="lead mb-4">Access the admin panel to manage tenders, employees, and all related data.</p>
            <a href="{% url 'admin:index' %}" class="btn btn-light btn-lg">
                <i class="bi bi-gear"></i> Go to Admin Panel
            </a>
        </div>
    </div>
</section> -->
{% endblock %}
